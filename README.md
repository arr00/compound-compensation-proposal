# @Compound-Community/merkle-distributor (forked from @dharma-eng/merkle-distributor)

These contracts have been modified to include a mechanism for "funding" the distributor from a specific funder and with a specific amount of the target token, designated at the time of deployment. The funder must first approve the distributor to transfer the tokens to be funded on its behalf.

## Usage for generating Compound COMP distribution merkle tree for 11/26/20 event
### Dependancies
- node version 10 or higher
- yarn
- run `yarn install` in the terminal while located at the project root to install the remaining dependancies
- run `export ETH_RPC=<YOUR-RPC-HERE>` to set your RPC as an ENV variable. This RPC must be using a archive node for operations in this repo to work.

### Generation
- Delete the `merkle-root` directory--you will be generating files here locally.

#### Affected Address List
- Create the list of affected addresses and COMP to distribute to them by running `yarn gen-compensation-balances`. This file is written to `merkle-root/addressBalances.json`. The numbers in this file are stored in hexadecimal value: if you want the decimal numbers, run `gen-compensation-balances-decimal` (stored to `merkle-root/addressBalancesDecimal.json`). 
- These scripts fetch the liquidation transactions which repaid Dai within the given block bounds (11332733 to 11335286). The repaid Dai is multiplied by 0.08 to attain the liquidation fee incured by the affected address.

#### Merkle Tree
- Once the address balances are attained, the merkle tree can be generated by running `yarn gen-merkle-root`. The merkle tree is written to `merkle-root/daiCompensationMerkleTree.json`. 
- This script uses the tried and proven code written by Uniswap for their UNI distribution. The list of addresses and amounts is inputted to it, and it generates a merkle tree. This tree allows for the smart contract to store a very small amount of data which represents all the data stored in the address-balance list.

### Testing
- run `yarn test` to run the tests associated with this project
- We have comprehensive unit tests along with a full network fork simulation of the proposal and claiming the dai from the distributor. Will add post depoloy and post propose simulations as necessary.
